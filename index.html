<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>آزمون یار - نسخه حرفه‌ای</title>
    <link rel="icon" href="icon.jpg" type="image/jpeg" />
    <link
      href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/aminpoint/b-naznin@1.0.0/b-naznin.css"
    />
    <style>
      /* فونت BNazanin */
      @font-face {
        font-family: "BNazanin";
        src: url("https://cdn.jsdelivr.net/gh/rastikerdar/b-nazanin@v2.4.0/B-NAZANIN.eot");
        src: url("https://cdn.jsdelivr.net/gh/rastikerdar/b-nazanin@v2.4.0/B-NAZANIN.eot?#iefix")
            format("embedded-opentype"),
          url("https://cdn.jsdelivr.net/gh/rastikerdar/b-nazanin@v2.4.0/B-NAZANIN.woff2")
            format("woff2"),
          url("https://cdn.jsdelivr.net/gh/rastikerdar/b-naznin@v2.4.0/B-NAZANIN.woff")
            format("woff"),
          url("https://cdn.jsdelivr.net/gh/rastikerdar/b-naznin@v2.4.0/B-NAZANIN.ttf")
            format("truetype");
        font-weight: normal;
        font-style: normal;
      }

      /* استایل تمام صفحه */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      /* تم اقیانوس (پیش‌فرض) */
      :root {
        --primary-color: #006994;
        --primary-light: #0088b2;
        --primary-dark: #005276;
        --secondary-color: #00b4d8;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --water-color: #e0f7ff;
        --water-light: #f0fbff;
        --water-dark: #b3e5fc;
        --text-color: #0a3d62;
        --text-muted: #4a6b8a;
        --border-color: #81d4fa;
        --card-bg: rgba(255, 255, 255, 0.92);
        --card-hover: rgba(255, 255, 255, 0.97);
        --header-bg: rgba(224, 247, 255, 0.92);
        --shadow: 0 8px 32px rgba(0, 105, 148, 0.18);
        --shadow-light: 0 4px 16px rgba(0, 105, 148, 0.12);
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        --gradient-water: linear-gradient(
          135deg,
          var(--water-light),
          var(--water-color)
        );
        --gradient-glass: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.75),
          rgba(255, 255, 255, 0.45)
        );
        --border-radius: 12px;
        --border-radius-sm: 8px;
        --border-radius-lg: 20px;
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        --transition-slow: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        --font-family: "BNazanin", Vazirmatn, sans-serif;
      }

      /* تم ساحل (روشن) - بهبود یافته */
      [data-theme="beach"] {
        --primary-color: #ff7e5f;
        --primary-light: #ff9e80;
        --primary-dark: #e85c40;
        --secondary-color: #feb47b;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --water-color: #fff5e6;
        --water-light: #fffaf0;
        --water-dark: #ffe4c4;
        --text-color: #5d4037;
        --text-muted: #8d6e63;
        --border-color: #ffccbc;
        --card-bg: rgba(255, 255, 255, 0.92);
        --card-hover: rgba(255, 255, 255, 0.97);
        --header-bg: rgba(255, 245, 230, 0.92);
        --shadow: 0 8px 32px rgba(255, 126, 95, 0.2);
        --shadow-light: 0 4px 16px rgba(255, 126, 95, 0.15);
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        --gradient-water: linear-gradient(
          135deg,
          var(--water-light),
          var(--water-color)
        );
        --gradient-glass: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.75),
          rgba(255, 255, 255, 0.45)
        );
      }

      /* تم کهکشان (بنفش) */
      [data-theme="galaxy"] {
        --primary-color: #8a2be2;
        --primary-light: #9370db;
        --primary-dark: #4b0082;
        --secondary-color: #00bfff;
        --success-color: #00fa9a;
        --warning-color: #ffd700;
        --danger-color: #ff4500;
        --water-color: #0c0032;
        --water-light: #190061;
        --water-dark: #04000f;
        --text-color: #e6e6fa;
        --text-muted: #a9a9a9;
        --border-color: #483d8b;
        --card-bg: rgba(25, 0, 97, 0.88);
        --card-hover: rgba(40, 0, 130, 0.92);
        --header-bg: rgba(12, 0, 50, 0.92);
        --shadow: 0 8px 32px rgba(138, 43, 226, 0.25);
        --shadow-light: 0 4px 16px rgba(138, 43, 226, 0.2);
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        --gradient-water: linear-gradient(
          135deg,
          var(--water-light),
          var(--water-color)
        );
        --gradient-glass: linear-gradient(
          135deg,
          rgba(25, 0, 97, 0.75),
          rgba(25, 0, 97, 0.45)
        );
      }

      /* تم معدن (سبز-آبی) */
      [data-theme="coal-mine"] {
        --primary-color: #4ecdc4;
        --primary-light: #68d8d6;
        --primary-dark: #2a9d8f;
        --secondary-color: #f9c74f;
        --success-color: #90be6d;
        --warning-color: #f8961e;
        --danger-color: #f94144;
        --water-color: #1a1a1d;
        --water-light: #2d2d30;
        --water-dark: #0d0d0d;
        --text-color: #edf2f4;
        --text-muted: #8d99ae;
        --border-color: #4a4e69;
        --card-bg: rgba(45, 45, 48, 0.88);
        --card-hover: rgba(55, 55, 58, 0.92);
        --header-bg: rgba(26, 26, 29, 0.92);
        --shadow: 0 8px 32px rgba(78, 205, 196, 0.25);
        --shadow-light: 0 4px 16px rgba(78, 205, 196, 0.2);
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        --gradient-water: linear-gradient(
          135deg,
          var(--water-light),
          var(--water-color)
        );
        --gradient-glass: linear-gradient(
          135deg,
          rgba(45, 45, 48, 0.75),
          rgba(45, 45, 48, 0.45)
        );
      }

      /* ریست استایل‌ها */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-family);
        background: var(--gradient-water);
        color: var(--text-color);
        line-height: 1.6;
        transition: var(--transition-slow);
        min-height: 100vh;
        padding: 0;
        margin: 0;
        overflow: hidden;
        backdrop-filter: blur(10px);
        position: relative;
        display: flex;
        flex-direction: column;
      }

      /* افکت‌های پس‌زمینه */
      .background-effects {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
        pointer-events: none;
      }

      .bubble {
        position: absolute;
        border-radius: 50%;
        background: var(--gradient-primary);
        opacity: 0.1;
        animation: float 15s infinite ease-in-out;
      }

      .bubble:nth-child(1) {
        width: 80px;
        height: 80px;
        top: 10%;
        left: 10%;
        animation-delay: 0s;
        animation-duration: 20s;
      }

      .bubble:nth-child(2) {
        width: 120px;
        height: 120px;
        top: 20%;
        right: 15%;
        animation-delay: 2s;
        animation-duration: 18s;
      }

      .bubble:nth-child(3) {
        width: 60px;
        height: 60px;
        bottom: 30%;
        left: 20%;
        animation-delay: 4s;
        animation-duration: 22s;
      }

      .bubble:nth-child(4) {
        width: 100px;
        height: 100px;
        bottom: 20%;
        right: 25%;
        animation-delay: 6s;
        animation-duration: 16s;
      }

      .bubble:nth-child(5) {
        width: 70px;
        height: 70px;
        top: 50%;
        left: 50%;
        animation-delay: 8s;
        animation-duration: 19s;
      }

      /* حباب‌های جدید */
      .bubble-small {
        position: absolute;
        border-radius: 50%;
        background: var(--secondary-color);
        opacity: 0.15;
        animation: floatSmall 12s infinite ease-in-out;
      }

      .bubble-small:nth-child(6) {
        width: 30px;
        height: 30px;
        top: 15%;
        right: 30%;
        animation-delay: 1s;
        animation-duration: 15s;
      }

      .bubble-small:nth-child(7) {
        width: 40px;
        height: 40px;
        bottom: 40%;
        left: 35%;
        animation-delay: 3s;
        animation-duration: 17s;
      }

      .bubble-small:nth-child(8) {
        width: 25px;
        height: 25px;
        top: 65%;
        right: 40%;
        animation-delay: 5s;
        animation-duration: 14s;
      }

      /* ذرات شناور */
      .particle {
        position: absolute;
        border-radius: 50%;
        background: var(--primary-light);
        opacity: 0.2;
        animation: particleFloat 20s infinite linear;
      }

      .particle:nth-child(9) {
        width: 10px;
        height: 10px;
        top: 25%;
        left: 20%;
        animation-delay: 0s;
        animation-duration: 25s;
      }

      .particle:nth-child(10) {
        width: 15px;
        height: 15px;
        bottom: 15%;
        right: 25%;
        animation-delay: 7s;
        animation-duration: 22s;
      }

      /* موج‌های پویا */
      .wave {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 200%;
        height: 15%;
        background: var(--water-dark);
        opacity: 0.1;
        border-radius: 50%;
        animation: waveAnimation 15s infinite linear;
        transform-origin: center bottom;
      }

      .wave:nth-child(11) {
        animation-delay: 0s;
        animation-duration: 12s;
        opacity: 0.15;
      }

      .wave:nth-child(12) {
        animation-delay: 3s;
        animation-duration: 10s;
        opacity: 0.1;
      }

      /* کانتینر اصلی */
      .container {
        max-width: 100%;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* هدر - کشیده شده تا گوشه‌ها */
      .header {
        background: var(--header-bg);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 1000;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 0;
        box-shadow: var(--shadow-light);
        width: 100%;
        padding: 0;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-color);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .logo i {
        font-size: 2.2rem;
        color: var(--primary-color);
        transition: var(--transition);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }

      .logo:hover i {
        transform: rotate(-15deg);
      }

      /* کنترل‌های هدر */
      .header-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .theme-selector {
        display: flex;
        gap: 8px;
        background: var(--gradient-glass);
        padding: 8px;
        border-radius: var(--border-radius);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-light);
      }

      .theme-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: transparent;
        color: var(--text-muted);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .theme-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        opacity: 0;
        transition: var(--transition);
        border-radius: 50%;
      }

      .theme-btn.active,
      .theme-btn:hover {
        color: white;
        transform: translateY(-3px);
        box-shadow: var(--shadow-light);
      }

      .theme-btn.active::before,
      .theme-btn:hover::before {
        opacity: 1;
      }

      .theme-btn i {
        position: relative;
        z-index: 1;
      }

      /* محتوای اصلی */
      .main-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      /* بهبود کلی نمایش در موبایل */
      @media (max-width: 768px) {
        .container {
          padding-bottom: 60px; /* فضای کافی برای منوی پایین */
        }

        .main-content {
          padding: 15px 10px;
        }

        .form-container,
        .exam-container,
        .calculator-container,
        .settings-container {
          margin: 10px 5px;
          padding: 20px 15px;
          border-radius: 16px;
        }

        .form-header h2 {
          font-size: 1.4rem;
        }

        .form-header p {
          font-size: 0.9rem;
        }

        .menu-header h2 {
          font-size: 1.5rem;
        }

        .menu-header p {
          font-size: 0.9rem;
        }

        .welcome-card {
          padding: 15px;
          flex-direction: column;
          text-align: center;
        }

        .welcome-avatar {
          width: 60px;
          height: 60px;
          font-size: 1.8rem;
          margin-bottom: 10px;
        }

        .welcome-text h3 {
          font-size: 1.1rem;
        }

        .welcome-text p {
          font-size: 0.9rem;
        }

        .menu-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .menu-card {
          padding: 20px;
        }

        .menu-icon {
          width: 60px;
          height: 60px;
          font-size: 1.8rem;
          margin-bottom: 15px;
        }

        .menu-card h3 {
          font-size: 1.2rem;
          margin-bottom: 10px;
        }

        .menu-card p {
          font-size: 0.9rem;
        }

        /* بهبود نمایش نوار پیشرفت */
        .progress-steps {
          margin: 0 -5px 30px -5px;
          padding: 0 5px 15px 5px;
        }

        .step {
          min-width: 60px;
        }

        .step-icon {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
        }

        .step-label {
          font-size: 0.75rem;
        }

        /* بهبود نمایش ماشین حساب */
        .calculator-inputs {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .calc-input-group label {
          font-size: 1rem;
        }

        .calc-input-group input {
          padding: 12px;
          font-size: 1rem;
        }

        .calculator-result {
          grid-template-columns: 1fr;
          gap: 15px;
          margin: 15px 0;
        }

        .result-box {
          padding: 20px;
        }

        .result-box h3 {
          font-size: 1rem;
          margin-bottom: 10px;
        }

        .percentage-value {
          font-size: 2rem;
        }

        /* بهبود نمایش دکمه‌ها */
        .btn {
          padding: 12px 20px;
          font-size: 1rem;
        }

        .form-actions {
          flex-direction: column;
          gap: 10px;
        }

        /* بهبود نمایش تنظیمات */
        .settings-section {
          padding: 20px;
        }

        .settings-section h3 {
          font-size: 1.1rem;
          margin-bottom: 15px;
        }

        .theme-selector-large {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .theme-btn-large {
          padding: 12px;
          font-size: 0.9rem;
        }

        .theme-btn-large i {
          font-size: 1.3rem;
        }

        .creator-info p {
          font-size: 0.9rem;
        }

        .love-message {
          font-size: 0.9rem;
          margin-top: 10px;
        }
      }

      /* بهبود نمایش در اندازه‌های بسیار کوچک */
      @media (max-width: 360px) {
        .header-content {
          padding: 10px;
        }

        .logo span {
          font-size: 1.2rem;
        }

        .logo i {
          font-size: 1.5rem;
        }

        .mobile-theme-toggle {
          width: 35px;
          height: 35px;
          font-size: 1rem;
        }

        .form-container,
        .exam-container,
        .calculator-container,
        .settings-container {
          padding: 15px 10px;
          margin: 5px;
        }

        .form-header h2 {
          font-size: 1.2rem;
        }

        .step {
          min-width: 50px;
        }

        .step-icon {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }

        .step-label {
          font-size: 0.7rem;
        }

        .form-group label {
          font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: 12px 15px;
          font-size: 1rem;
        }

        .menu-card {
          padding: 15px;
        }

        .menu-icon {
          width: 50px;
          height: 50px;
          font-size: 1.5rem;
        }

        .menu-card h3 {
          font-size: 1.1rem;
        }

        .percentage-value {
          font-size: 1.8rem;
        }

        .footer-content p {
          font-size: 0.75rem;
        }
      }

      /* بهبود نمایش فوتر در تمام تم‌ها */
      .footer {
        margin-top: auto;
        padding: 15px 20px;
        text-align: center;
        border-top: 1px solid var(--border-color);
        width: 100%;
        background: var(--header-bg);
        backdrop-filter: blur(10px);
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-content p {
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
        font-size: 0.9rem;
        margin: 0;
        line-height: 1.5;
      }

      .footer-content i {
        color: #e74c3c;
        animation: heartbeat 1.5s infinite;
      }

      /* بهبود نمایش در موبایل */
      @media (max-width: 768px) {
        .footer {
          padding: 12px 15px;
        }

        .footer-content p {
          flex-direction: column;
          gap: 5px;
          font-size: 0.8rem;
        }

        .love-message {
          font-size: 0.9rem !important;
          margin-top: 10px !important;
        }
      }

      /* بهبود نمایش در تنظیمات */
      .settings-section {
        position: relative;
      }

      .creator-info {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .creator-info p {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 0;
        font-size: 0.95rem;
      }

      .love-message {
        margin-top: 15px;
        font-weight: 500;
        color: var(--primary-color);
        text-align: center;
        font-size: 1rem;
      }

      /* بهبود نمایش در تم کهکشان */
      [data-theme="galaxy"] .love-message {
        color: #9370db !important;
      }

      /* بهبود نمایش در تم معدن زغال سنگ */
      [data-theme="coal-mine"] .love-message {
        color: #f9c74f !important;
      }

      /* بهبود نمایش در تم کهکشان برای موبایل */
      [data-theme="galaxy"] .footer-content p,
      [data-theme="galaxy"] .love-message {
        color: #e6e6fa !important;
      }

      [data-theme="galaxy"] .theme-color.galaxy {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
      }

      /* بهبود نمایش منوی کشویی تم در کهکشان */
      [data-theme="galaxy"] .mobile-theme-menu {
        background: rgba(25, 0, 97, 0.95);
        border-left: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .theme-menu-header {
        border-bottom: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .close-theme-menu {
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .close-theme-menu:hover {
        background: rgba(138, 43, 226, 0.2);
        color: white;
      }

      [data-theme="galaxy"] .mobile-theme-option {
        background: rgba(25, 0, 97, 0.7);
        border: 1px solid #483d8b;
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .mobile-theme-option.active,
      [data-theme="galaxy"] .mobile-theme-option:hover {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
        color: white;
      }

      /* صفحه */
      .page {
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: var(--transition-slow);
        height: 100%;
      }

      .page.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
        animation: fadeInUp 0.6s ease;
      }

      /* کانتینر فرم */
      .form-container {
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        padding: 40px;
        box-shadow: var(--shadow);
        max-width: 600px;
        margin: 0 auto;
        transition: var(--transition);
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .form-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-primary);
      }

      .form-header {
        text-align: center;
        margin-bottom: 30px;
        animation: fadeInUp 0.6s ease;
      }

      .form-header h2 {
        color: var(--primary-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        font-size: 2rem;
      }

      .form-header p {
        color: var(--text-muted);
        font-size: 1.2rem;
      }

      /* پیشرفت ثبت نام - بهبود یافته */
      .progress-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        position: relative;
        animation: fadeInUp 0.8s ease;
      }

      .progress-line {
        position: absolute;
        top: 30px;
        left: 10%;
        right: 10%;
        height: 4px;
        background: var(--border-color);
        z-index: 1;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient-primary);
        width: 0%;
        transition: width 0.5s ease;
        border-radius: 2px;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
      }

      .step-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--water-dark);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        transition: var(--transition);
        border: 2px solid var(--border-color);
        font-size: 1.5rem;
        color: var(--text-muted);
      }

      .step.active .step-icon {
        background: var(--gradient-primary);
        color: white;
        border-color: var(--primary-color);
        transform: scale(1.1);
        box-shadow: var(--shadow-light);
      }

      .step.completed .step-icon {
        background: var(--success-color);
        color: white;
        border-color: var(--success-color);
      }

      .step-label {
        font-size: 1rem;
        color: var(--text-muted);
        text-align: center;
        font-weight: 500;
      }

      .step.active .step-label {
        color: var(--primary-color);
        font-weight: 700;
      }

      /* فرم */
      .user-form {
        display: flex;
        flex-direction: column;
        gap: 25px;
        animation: fadeInUp 1s ease;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-group label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 500;
        color: var(--text-color);
        font-size: 1.1rem;
      }

      .form-group label i {
        color: var(--primary-color);
        width: 20px;
        font-size: 1.2rem;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 15px 20px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        background: var(--water-light);
        color: var(--text-color);
        font-family: var(--font-family);
        transition: var(--transition);
        font-size: 1.1rem;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(27, 154, 170, 0.2);
        transform: translateY(-2px);
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
      }

      /* دکمه‌ها */
      .form-actions {
        margin-top: 20px;
        display: flex;
        gap: 15px;
        justify-content: center;
        animation: fadeInUp 1.2s ease;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: var(--border-radius);
        font-family: var(--font-family);
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
        font-size: 1.1rem;
      }

      .btn-primary {
        background: var(--gradient-primary);
        color: white;
        box-shadow: var(--shadow-light);
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
      }

      .btn-primary:active {
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: transparent;
        color: var(--text-color);
        border: 2px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: rgba(52, 152, 219, 0.1);
        border-color: var(--primary-color);
        transform: translateY(-3px);
      }

      /* منوی اصلی */
      .menu-container {
        max-width: 1000px;
        margin: 0 auto;
      }

      .menu-header {
        text-align: center;
        margin-bottom: 40px;
        animation: fadeInUp 0.6s ease;
      }

      .menu-header h2 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 2.2rem;
      }

      .menu-header p {
        color: var(--text-muted);
        font-size: 1.2rem;
      }

      .welcome-card {
        display: flex;
        align-items: center;
        gap: 20px;
        background: var(--gradient-glass);
        border-radius: var(--border-radius);
        padding: 25px;
        margin-bottom: 40px;
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        animation: slideInLeft 0.6s ease;
      }

      .welcome-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2.5rem;
        box-shadow: var(--shadow);
        transition: var(--transition);
      }

      .welcome-card:hover .welcome-avatar {
        transform: scale(1.05) rotate(5deg);
      }

      .welcome-text h3 {
        color: var(--primary-color);
        margin-bottom: 5px;
      }

      .welcome-text p {
        color: var(--text-muted);
      }

      .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
      }

      .menu-card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 25px;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
        position: relative;
        overflow: hidden;
      }

      .menu-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-primary);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
      }

      .menu-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
        background: var(--card-hover);
      }

      .menu-card:hover::before {
        transform: scaleX(1);
      }

      .menu-icon {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        color: white;
        font-size: 2rem;
        transition: var(--transition);
        position: relative;
        z-index: 1;
      }

      .menu-card:hover .menu-icon {
        transform: scale(1.1) rotate(5deg);
      }

      .menu-card h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        font-size: 1.5rem;
        position: relative;
        z-index: 1;
      }

      .menu-card p {
        color: var(--text-muted);
        flex-grow: 1;
        position: relative;
        z-index: 1;
      }

      /* صفحه محاسبه درصد - بهبود یافته */
      .calculator-container {
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        padding: 40px;
        box-shadow: var(--shadow);
        max-width: 800px;
        margin: 0 auto;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }

      .calculator-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-primary);
      }

      .calculator-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .calculator-header h2 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 2.2rem;
      }

      .calculator-header p {
        color: var(--text-muted);
        font-size: 1.2rem;
      }

      .calculator-form {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .calculator-inputs {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
      }

      .calc-input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .calc-input-group label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 500;
        color: var(--text-color);
      }

      .calc-input-group label i {
        color: var(--primary-color);
        width: 20px;
        font-size: 1.2rem;
      }

      .calc-input-group input {
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-sm);
        background: var(--water-light);
        color: var(--text-color);
        font-family: var(--font-family);
        transition: var(--transition);
        font-size: 1.1rem;
        text-align: center;
      }

      .calc-input-group input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(27, 154, 170, 0.2);
        transform: translateY(-2px);
      }

      .calculator-result {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .result-box {
        background: var(--gradient-glass);
        border-radius: var(--border-radius);
        padding: 25px;
        text-align: center;
        border: 1px solid var(--border-color);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .result-box::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        z-index: 0;
      }

      .result-box:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-light);
      }

      .potential-result {
        background: linear-gradient(
          135deg,
          rgba(46, 204, 113, 0.1),
          rgba(46, 204, 113, 0.2)
        );
        border-color: rgba(46, 204, 113, 0.3);
      }

      .result-box h3 {
        color: var(--text-muted);
        margin-bottom: 15px;
        font-size: 1.1rem;
        position: relative;
        z-index: 1;
      }

      .percentage-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        z-index: 1;
      }

      .potential-result .percentage-value {
        color: var(--success-color);
      }

      /* سایر صفحات */
      .exam-container,
      .settings-container {
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        padding: 40px;
        box-shadow: var(--shadow);
        max-width: 800px;
        margin: 0 auto;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }

      .exam-container::before,
      .settings-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-primary);
      }

      .exam-header,
      .settings-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .exam-header h2,
      .settings-header h2 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 2.2rem;
      }

      .exam-header p,
      .settings-header p {
        color: var(--text-muted);
        font-size: 1.2rem;
      }

      .exam-form {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .settings-content {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .settings-section {
        background: var(--gradient-glass);
        border-radius: var(--border-radius);
        padding: 25px;
        border: 1px solid var(--border-color);
        transition: var(--transition);
      }

      .settings-section:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-light);
        background: var(--card-hover);
      }

      .settings-section h3 {
        color: var(--primary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .love-message {
        margin-top: 15px;
        font-weight: 500;
        color: var(--primary-color);
        text-align: center;
        font-size: 1rem;
        display: block;
        width: 100%;
      }

      /* بهبود نمایش در موبایل */
      @media (max-width: 768px) {
        .love-message {
          font-size: 0.9rem !important;
          margin-top: 10px !important;
        }
      }

      /* انتخابگر تم بزرگ در تنظیمات */
      .theme-selector-large {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .theme-btn-large {
        padding: 15px;
        border: none;
        border-radius: var(--border-radius);
        background: var(--gradient-glass);
        color: var(--text-color);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .theme-btn-large::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        opacity: 0;
        transition: var(--transition);
      }

      .theme-btn-large.active,
      .theme-btn-large:hover {
        color: white;
        transform: translateY(-3px);
        box-shadow: var(--shadow-light);
      }

      .theme-btn-large.active::before,
      .theme-btn-large:hover::before {
        opacity: 1;
      }

      .theme-btn-large i {
        font-size: 1.5rem;
        position: relative;
        z-index: 1;
      }

      .theme-btn-large span {
        font-weight: 500;
        position: relative;
        z-index: 1;
      }

      .creator-info {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .creator-info p {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .love-message {
        margin-top: 15px;
        font-weight: 500;
        color: var(--primary-color);
        text-align: center;
      }

      @media (min-width: 769px) {
        .mobile-theme-menu {
          display: none;
        }

        .theme-menu-overlay {
          display: none;
        }
      }

      /* صفحه‌های غیرفعال */
      .page-placeholder {
        text-align: center;
        padding: 60px 20px;
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        max-width: 600px;
        margin: 0 auto;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
      }

      .page-placeholder i {
        font-size: 5rem;
        color: var(--primary-color);
        margin-bottom: 30px;
        display: block;
        animation: pulse 2s infinite;
      }

      .page-placeholder h2 {
        color: var(--primary-color);
        margin-bottom: 15px;
      }

      .page-placeholder p {
        color: var(--text-muted);
        margin-bottom: 30px;
        font-size: 1.2rem;
      }

      /* بهبود نمایش در تم کهکشان برای موبایل */
      [data-theme="galaxy"] .footer-content p,
      [data-theme="galaxy"] .love-message {
        color: #e6e6fa !important;
      }

      [data-theme="galaxy"] .theme-color.galaxy {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
      }

      /* بهبود نمایش منوی کشویی تم در کهکشان */
      [data-theme="galaxy"] .mobile-theme-menu {
        background: rgba(25, 0, 97, 0.95);
        border-left: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .theme-menu-header {
        border-bottom: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .close-theme-menu {
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .close-theme-menu:hover {
        background: rgba(138, 43, 226, 0.2);
        color: white;
      }

      [data-theme="galaxy"] .mobile-theme-option {
        background: rgba(25, 0, 97, 0.7);
        border: 1px solid #483d8b;
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .mobile-theme-option.active,
      [data-theme="galaxy"] .mobile-theme-option:hover {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
        color: white;
      }

      /* بهبود نمایش تعداد کل سوالات در تم کهکشان */
      [data-theme="galaxy"] .total-questions-display {
        background: rgba(25, 0, 97, 0.3);
        border-color: #483d8b;
        color: #e6e6fa;
      }

      /* نوار پیشرفت */
      .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: transparent;
        z-index: 1001;
      }

      .progress-bar {
        height: 100%;
        background: var(--gradient-primary);
        width: 0%;
        transition: width 0.4s ease;
      }

      /* فوتر */
      .footer {
        margin-top: auto;
        padding: 20px;
        text-align: center;
        border-top: 1px solid var(--border-color);
        width: 100%;
      }

      .footer-content p {
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .footer-content i {
        color: #e74c3c;
        animation: heartbeat 1.5s infinite;
      }

      /* انیمیشن‌های جدید و بهبود یافته */
      @keyframes countUp {
        from {
          transform: scale(0.5);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes glow {
        0% {
          text-shadow: 0 0 5px rgba(46, 204, 113, 0.5);
        }
        50% {
          text-shadow: 0 0 20px rgba(46, 204, 113, 0.8);
        }
        100% {
          text-shadow: 0 0 5px rgba(46, 204, 113, 0.5);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(10deg);
        }
        100% {
          transform: translateY(0) rotate(0deg);
        }
      }

      @keyframes floatSmall {
        0% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
        50% {
          transform: translateY(-15px) rotate(5deg) scale(1.1);
        }
        100% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
      }

      @keyframes particleFloat {
        0% {
          transform: translateY(0) translateX(0) rotate(0deg);
        }
        25% {
          transform: translateY(-30px) translateX(20px) rotate(90deg);
        }
        50% {
          transform: translateY(-50px) translateX(-20px) rotate(180deg);
        }
        75% {
          transform: translateY(-30px) translateX(10px) rotate(270deg);
        }
        100% {
          transform: translateY(0) translateX(0) rotate(360deg);
        }
      }

      @keyframes waveAnimation {
        0% {
          transform: translateX(0) rotate(0deg);
        }
        50% {
          transform: translateX(-25%) rotate(2deg);
        }
        100% {
          transform: translateX(-50%) rotate(0deg);
        }
      }

      @keyframes heartbeat {
        0% {
          transform: scale(1);
        }
        5% {
          transform: scale(1.1);
        }
        10% {
          transform: scale(1);
        }
        15% {
          transform: scale(1.1);
        }
        20% {
          transform: scale(1);
        }
      }

      /* انیمیشن‌های جدید اضافه شده */
      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      @keyframes ripple {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        100% {
          transform: scale(4);
          opacity: 0;
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-20px);
        }
        60% {
          transform: translateY(-10px);
        }
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes typewriter {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }

      @keyframes percentageCount {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes themeChange {
        0% {
          opacity: 0.8;
          transform: scale(0.95);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* انیمیشن‌های جدید برای تکمیل ثبت نام */
      @keyframes successPulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
        }
        70% {
          transform: scale(1.05);
          box-shadow: 0 0 0 20px rgba(46, 204, 113, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
        }
      }

      @keyframes confettiFall {
        0% {
          transform: translateY(-100px) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      @keyframes checkmark {
        0% {
          stroke-dashoffset: 100;
          opacity: 0;
          transform: scale(0.8);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
        100% {
          stroke-dashoffset: 0;
          opacity: 1;
          transform: scale(1);
        }
      }

      /* استایل‌های جدید برای انیمیشن‌ها */
      .ripple-effect {
        position: relative;
        overflow: hidden;
      }

      .ripple-effect::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
      }

      .ripple-effect:focus:not(:active)::after {
        animation: ripple 1s ease-out;
      }

      .shimmer {
        background: linear-gradient(
          to right,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.3) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        background-size: 1000px 100%;
        animation: shimmer 2s infinite;
      }

      .bounce-animation {
        animation: bounce 1s;
      }

      .rotate-animation {
        animation: rotate 2s linear infinite;
      }

      .typewriter h2,
      .typewriter p {
        overflow: hidden;
        white-space: nowrap;
        animation: typewriter 2s steps(40) forwards;
      }

      .percentage-animation {
        animation: percentageCount 0.8s ease forwards;
      }

      .theme-change-animation {
        animation: themeChange 0.8s ease forwards;
      }

      /* بهبود هدر برای موبایل */
      @media (max-width: 768px) {
        .header-content {
          padding: 12px 15px;
        }

        .logo span {
          font-size: 1.4rem;
        }

        .logo i {
          font-size: 1.8rem;
        }

        .theme-selector {
          display: none;
          position: absolute;
          top: 100%;
          right: 0;
          background: var(--header-bg);
          backdrop-filter: blur(15px);
          border: 1px solid var(--border-color);
          border-radius: var(--border-radius);
          padding: 10px;
          box-shadow: var(--shadow);
          z-index: 1001;
          flex-direction: column;
          width: 150px;
        }

        .theme-selector.active {
          display: flex;
        }

        .mobile-theme-toggle {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: var(--gradient-glass);
          border: 1px solid var(--border-color);
          color: var(--primary-color);
          font-size: 1.2rem;
          cursor: pointer;
          transition: var(--transition);
        }

        .mobile-theme-toggle:hover {
          background: var(--gradient-primary);
          color: white;
        }
      }

      /* بهبود منوی کشویی تم برای موبایل */
      .mobile-theme-menu {
        position: fixed;
        top: 0;
        right: -100%;
        width: 85%;
        max-width: 320px;
        height: 100%;
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        z-index: 2000;
        padding: 20px;
        box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15);
        transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        overflow-y: auto;
        border-left: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }

      .mobile-theme-menu.active {
        right: 0;
      }

      .theme-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
      }

      .theme-menu-header h3 {
        color: var(--primary-color);
        margin: 0;
        font-size: 1.3rem;
      }

      .close-theme-menu {
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .close-theme-menu:hover {
        background: rgba(0, 0, 0, 0.05);
        color: var(--primary-color);
      }

      .mobile-theme-options {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 10px;
      }

      .mobile-theme-option {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 16px;
        border-radius: var(--border-radius);
        background: var(--gradient-glass);
        border: 1px solid var(--border-color);
        cursor: pointer;
        transition: var(--transition);
        text-align: right;
        width: 100%;
        position: relative;
        overflow: hidden;
      }

      .mobile-theme-option::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        opacity: 0;
        transition: var(--transition);
      }

      .mobile-theme-option:hover {
        transform: translateX(-5px);
        box-shadow: var(--shadow-light);
      }

      .mobile-theme-option.active,
      .mobile-theme-option:hover {
        color: white;
      }

      .mobile-theme-option.active::before,
      .mobile-theme-option:hover::before {
        opacity: 1;
      }

      .theme-color {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        flex-shrink: 0;
        position: relative;
        z-index: 1;
      }

      .theme-color.ocean {
        background: linear-gradient(135deg, #006994, #005276);
      }

      .theme-color.beach {
        background: linear-gradient(135deg, #ff7e5f, #e85c40);
      }

      .theme-color.galaxy {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
      }

      .theme-color.coal-mine {
        background: linear-gradient(135deg, #4ecdc4, #2a9d8f);
      }

      .mobile-theme-option span {
        font-weight: 500;
        position: relative;
        z-index: 1;
        flex-grow: 1;
        text-align: right;
      }

      /* لایه overlay برای منوی تم */
      .theme-menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        backdrop-filter: blur(3px);
      }

      .theme-menu-overlay.active {
        opacity: 1;
        pointer-events: all;
      }

      /* بهبود نمایش در تم کهکشان */
      [data-theme="galaxy"] .mobile-theme-menu {
        background: rgba(25, 0, 97, 0.95);
        border-left: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .theme-menu-header {
        border-bottom: 1px solid #483d8b;
      }

      [data-theme="galaxy"] .close-theme-menu {
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .close-theme-menu:hover {
        background: rgba(138, 43, 226, 0.2);
        color: white;
      }

      [data-theme="galaxy"] .mobile-theme-option {
        background: rgba(25, 0, 97, 0.7);
        border: 1px solid #483d8b;
        color: #e6e6fa;
      }

      [data-theme="galaxy"] .mobile-theme-option.active,
      [data-theme="galaxy"] .mobile-theme-option:hover {
        background: linear-gradient(135deg, #8a2be2, #4b0082);
        color: white;
      }

      /* بهبود نمایش در تم معدن زغال سنگ */
      [data-theme="coal-mine"] .mobile-theme-menu {
        background: rgba(45, 45, 48, 0.95);
        border-left: 1px solid #4a4e69;
      }

      [data-theme="coal-mine"] .theme-menu-header {
        border-bottom: 1px solid #4a4e69;
      }

      [data-theme="coal-mine"] .mobile-theme-option {
        background: rgba(45, 45, 48, 0.7);
        border: 1px solid #4a4e69;
        color: #edf2f4;
      }

      /* دکمه باز کردن منوی تم در موبایل */
      .mobile-theme-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: var(--gradient-glass);
        border: 1px solid var(--border-color);
        color: var(--primary-color);
        font-size: 1.3rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .mobile-theme-toggle:hover {
        background: var(--gradient-primary);
        color: white;
        transform: scale(1.05);
      }

      /* بهبود برای صفحه نمایش کوچک */
      @media (max-width: 360px) {
        .mobile-theme-menu {
          width: 80%;
          padding: 15px;
        }

        .mobile-theme-option {
          padding: 14px;
        }

        .theme-menu-header h3 {
          font-size: 1.2rem;
        }
      }

      /* بهبود نمایش نوار وضعیت در موبایل */
      @media (max-width: 768px) {
        .progress-steps {
          flex-wrap: nowrap;
          overflow-x: auto;
          padding-bottom: 15px;
          justify-content: space-between;
          margin-left: -10px;
          margin-right: -10px;
          padding-left: 10px;
          padding-right: 10px;
        }

        .step {
          flex: 0 0 auto;
          min-width: 70px;
        }

        .step-label {
          font-size: 0.8rem;
          white-space: nowrap;
        }

        .progress-line {
          display: block;
          top: 30px;
          left: 15%;
          right: 15%;
        }

        /* مخفی کردن اسکرولبار برای مرورگرهای وبکیت */
        .progress-steps::-webkit-scrollbar {
          display: none;
        }

        .progress-steps {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      }

      /* بهبود نمایش فیلدهای محاسبه درصد در موبایل */
      @media (max-width: 480px) {
        .calculator-inputs {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .calc-input-group input {
          padding: 12px;
          font-size: 1rem;
        }

        .calculator-result {
          grid-template-columns: 1fr;
        }

        .percentage-value {
          font-size: 2rem;
        }
      }

      /* بهبود نمایش فرم در موبایل */
      @media (max-width: 768px) {
        .form-container,
        .exam-container,
        .calculator-container,
        .settings-container {
          padding: 20px;
          margin: 10px;
          border-radius: var(--border-radius);
        }

        .form-header h2 {
          font-size: 1.5rem;
        }

        .form-header p {
          font-size: 1rem;
        }

        .menu-header h2 {
          font-size: 1.6rem;
        }

        .welcome-card {
          flex-direction: column;
          text-align: center;
          padding: 20px;
        }

        .welcome-avatar {
          width: 70px;
          height: 70px;
          font-size: 2rem;
        }
      }

      /* بهبود نمایش منو در موبایل */
      @media (max-width: 768px) {
        .menu-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .menu-card {
          padding: 20px;
        }

        .menu-icon {
          width: 60px;
          height: 60px;
          font-size: 1.8rem;
        }

        .menu-card h3 {
          font-size: 1.3rem;
        }
      }

      /* بهبود نمایش فوتر در موبایل */
      @media (max-width: 768px) {
        .footer {
          padding: 15px;
        }

        .footer-content p {
          font-size: 0.9rem;
          flex-direction: column;
          gap: 5px;
        }
      }

      /* استایل‌های جدید برای انیمیشن تکمیل ثبت نام */
      .completion-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      .completion-animation.active {
        opacity: 1;
        pointer-events: all;
      }

      .completion-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        position: relative;
        transform: scale(0.8);
        transition: transform 0.5s ease;
        max-width: 400px;
        width: 80%;
      }

      .completion-animation.active .completion-content {
        transform: scale(1);
      }

      .checkmark-container {
        width: 100px;
        height: 100px;
        margin: 0 auto 20px;
        position: relative;
      }

      .checkmark-circle {
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: checkmark 1s ease-in-out forwards;
        stroke: #2ecc71;
        stroke-width: 5;
        fill: none;
      }

      .checkmark {
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: checkmark 1s ease-in-out 0.5s forwards;
        stroke: #2ecc71;
        stroke-width: 5;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #f1c40f;
        opacity: 0;
      }

      .completion-title {
        font-size: 1.8rem;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .completion-message {
        color: #7f8c8d;
        margin-bottom: 20px;
      }

      /* استایل‌های جدید برای موبایل */
      .mobile-menu-btn {
        display: none;
        background: transparent;
        border: none;
        color: var(--primary-color);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
      }

      .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--header-bg);
        backdrop-filter: blur(10px);
        z-index: 999;
        display: none;
        padding: 10px;
        border-top: 1px solid var(--border-color);
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      }

      .mobile-nav-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .mobile-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 5px;
        border-radius: var(--border-radius-sm);
        transition: var(--transition);
        color: var(--text-muted);
        text-decoration: none;
      }

      .mobile-nav-item.active,
      .mobile-nav-item:hover {
        background: var(--gradient-primary);
        color: white;
      }

      .mobile-nav-item i {
        font-size: 1.2rem;
        margin-bottom: 5px;
      }

      .mobile-nav-item span {
        font-size: 0.8rem;
      }

      /* استایل نمایش تعداد کل سوالات */
      .total-questions-display {
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-sm);
        background: var(--water-light);
        color: var(--text-color);
        font-family: var(--font-family);
        font-size: 1.1rem;
        text-align: center;
        font-weight: bold;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* بهبود نمایش در موبایل */
      @media (max-width: 768px) {
        .total-questions-display {
          padding: 12px;
          font-size: 1rem;
          min-height: 45px;
        }
      }

      /* رسپانسیو - بهبود یافته برای موبایل */
      @media (max-width: 1024px) {
        .calculator-inputs {
          grid-template-columns: repeat(2, 1fr);
        }

        .calculator-result {
          grid-template-columns: 1fr;
        }

        .theme-selector-large {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 0;
        }

        .main-content {
          padding: 15px;
        }

        .form-container,
        .exam-container,
        .calculator-container,
        .settings-container {
          padding: 25px;
        }

        .header-content {
          flex-direction: row;
          justify-content: space-between;
          gap: 15px;
          padding: 15px;
        }

        .logo span {
          font-size: 1.5rem;
        }

        .mobile-menu-btn {
          display: block;
        }

        .theme-selector {
          display: none;
        }

        .menu-grid {
          grid-template-columns: 1fr;
        }

        .calculator-inputs {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .welcome-card {
          flex-direction: column;
          text-align: center;
        }

        .progress-steps {
          flex-wrap: wrap;
          justify-content: center;
          gap: 20px;
        }

        .progress-line {
          display: none;
        }

        .mobile-nav {
          display: block;
        }

        /* بهبود فونت‌ها برای موبایل */
        .form-header h2 {
          font-size: 1.6rem;
        }

        .menu-header h2 {
          font-size: 1.8rem;
        }

        .exam-header h2,
        .calculator-header h2,
        .settings-header h2 {
          font-size: 1.8rem;
        }

        .welcome-text h3 {
          font-size: 1.2rem;
        }

        .menu-card h3 {
          font-size: 1.3rem;
        }

        .percentage-value {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .form-container,
        .exam-container,
        .calculator-container,
        .settings-container {
          padding: 20px 15px;
        }

        .logo span {
          display: none;
        }

        .form-header h2 {
          font-size: 1.4rem;
        }

        .step-icon {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
        }

        .step-label {
          font-size: 0.9rem;
        }

        .welcome-avatar {
          width: 60px;
          height: 60px;
          font-size: 1.8rem;
        }

        .menu-icon {
          width: 60px;
          height: 60px;
          font-size: 1.5rem;
        }

        .mobile-nav-grid {
          grid-template-columns: repeat(3, 1fr);
        }

        .mobile-nav-item span {
          font-size: 0.7rem;
        }
      }

      /* بهبود نمایش لمسی برای موبایل */
      @media (hover: none) {
        .menu-card:hover {
          transform: none;
        }

        .menu-card:hover .menu-icon {
          transform: none;
        }

        .result-box:hover {
          transform: none;
        }

        .settings-section:hover {
          transform: none;
        }

        .btn:active {
          transform: scale(0.98);
        }

        .btn-primary:active {
          transform: scale(0.98) translateY(0);
        }

        .btn-secondary:active {
          transform: scale(0.98) translateY(0);
        }
      }
    </style>
  </head>
  <body data-theme="ocean">
    <!-- نوار پیشرفت -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- افکت پس‌زمینه -->
    <div class="background-effects">
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble-small"></div>
      <div class="bubble-small"></div>
      <div class="bubble-small"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    </div>

    <!-- انیمیشن تکمیل ثبت نام -->
    <div class="completion-animation" id="completionAnimation">
      <div class="completion-content">
        <div class="checkmark-container">
          <svg viewBox="0 0 100 100">
            <circle class="checkmark-circle" cx="50" cy="50" r="45" />
            <path class="checkmark" d="M25,50 l15,15 l35,-35" />
          </svg>
        </div>
        <h2 class="completion-title">اطلاعات شما با موفقیت ثبت شد</h2>
        <p class="completion-message">به آزمون یار خوش آمدید 🥰.</p>
        <button class="btn btn-primary" onclick="hideCompletionAnimation()">
          ادامه به منوی اصلی
        </button>
      </div>
    </div>

    <div class="container">
      <!-- هدر - کشیده شده تا گوشه‌ها -->
      <header class="header">
        <div class="header-content">
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
          </button>

          <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>آزمون یار</span>
          </div>

          <div class="header-controls">
            <button class="mobile-theme-toggle" id="mobileThemeToggle">
              <i class="fas fa-palette"></i>
            </button>

            <div class="theme-selector" id="themeSelector">
              <button
                class="theme-btn active"
                data-theme="ocean"
                title="تم اقیانوس"
              >
                <i class="fas fa-water"></i>
              </button>
              <button class="theme-btn" data-theme="beach" title="تم ساحل">
                <i class="fas fa-umbrella-beach"></i>
              </button>
              <button class="theme-btn" data-theme="galaxy" title="تم کهکشان">
                <i class="fas fa-gem"></i>
              </button>
              <button
                class="theme-btn"
                data-theme="coal-mine"
                title="تم معدن زغال سنگ"
              >
                <i class="fas fa-mountain"></i>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- محتوای اصلی -->
      <main class="main-content">
        <!-- صفحه اطلاعات کاربر -->
        <section id="user-info" class="page active">
          <div class="form-container">
            <div class="form-header">
              <h2><i class="fas fa-user-circle"></i> اطلاعات دانش آموز</h2>
              <p>لطفا اطلاعات خود را وارد کنید تا کارنامه شما ذخیره شود</p>
            </div>

            <!-- نمایش پیشرفت ثبت نام -->
            <div class="progress-steps">
              <div class="step completed" id="step-name">
                <div class="step-icon">
                  <i class="fas fa-user"></i>
                </div>
                <span class="step-label">نام</span>
              </div>
              <div class="step" id="step-field">
                <div class="step-icon">
                  <i class="fas fa-atom"></i>
                </div>
                <span class="step-label">رشته</span>
              </div>
              <div class="step" id="step-grade">
                <div class="step-icon">
                  <i class="fas fa-book"></i>
                </div>
                <span class="step-label">پایه</span>
              </div>
              <div class="step" id="step-complete">
                <div class="step-icon">
                  <i class="fas fa-check"></i>
                </div>
                <span class="step-label">تکمیل</span>
              </div>
              <div class="progress-line">
                <div class="progress-fill" id="progressFill"></div>
              </div>
            </div>

            <form class="user-form">
              <div class="form-group">
                <label for="studentName">
                  <i class="fas fa-signature"></i>
                  نام و نام خانوادگی:
                </label>
                <input
                  type="text"
                  id="studentName"
                  placeholder="نام و نام خانوادگی خود را وارد کنید"
                />
              </div>

              <div class="form-group">
                <label for="field">
                  <i class="fas fa-atom"></i>
                  رشته تحصیلی:
                </label>
                <select id="field">
                  <option value="">رشته را انتخاب کنید</option>
                  <option value="riazi">ریاضی فیزیک</option>
                  <option value="tajrobi">علوم تجربی</option>
                  <option value="ensani">علوم انسانی</option>
                </select>
              </div>

              <div class="form-group">
                <label for="grade">
                  <i class="fas fa-book"></i>
                  پایه تحصیلی:
                </label>
                <select id="grade">
                  <option value="">پایه را انتخاب کنید</option>
                  <option value="10">دهم</option>
                  <option value="11">یازدهم</option>
                  <option value="12">دوازدهم</option>
                </select>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-primary ripple-effect"
                  id="save-btn"
                >
                  <i class="fas fa-check"></i>
                  <span>تایید و ادامه</span>
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- صفحه منوی اصلی -->
        <section id="main-menu" class="page">
          <div class="menu-container">
            <div class="menu-header">
              <h2><i class="fas fa-home"></i> منوی اصلی</h2>
              <p>لطفا گزینه مورد نظر خود را انتخاب کنید</p>
            </div>

            <div class="welcome-card">
              <div class="welcome-avatar">
                <i class="fas fa-user-graduate"></i>
              </div>
              <div class="welcome-text">
                <h3><span id="welcome-name">کاربر</span> عزیز، خوش آمدید!</h3>
                <p>امروز می‌خواهید چه آزمونی را تحلیل کنید؟</p>
              </div>
            </div>

            <div class="menu-grid">
              <div
                class="menu-card"
                onclick="window.location.href='DigitalYar.html'"
              >
                <div class="menu-icon">
                  <i class="fas fa-laptop"></i>
                </div>
                <h3>دیجیتال‌یار</h3>
                <p>وارد کردن پاسخ‌ها و اطلاعات آزمون به صورت دستی</p>
              </div>

              <div class="menu-card" onclick="navigateToBargehyar()">
                <div class="menu-icon">
                  <i class="fas fa-file-alt"></i>
                </div>
                <h3>برگه‌یار</h3>
                <p>تحلیل کارنامه با استفاده از کدهای هوش مصنوعی</p>
              </div>

              <div class="menu-card" onclick="navigateTo('saved-exams')">
                <div class="menu-icon">
                  <i class="fas fa-folder"></i>
                </div>
                <h3>پوشه آزمون‌ها</h3>
                <p>مدیریت و مشاهده آزمون های ذخیره شده</p>
              </div>

              <div class="menu-card" onclick="navigateTo('exam-process')">
                <div class="menu-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <h3>روند آزمون</h3>
                <p>بررسی روند پیشرفت درسی در آزمون‌ها</p>
              </div>

              <div
                class="menu-card"
                onclick="navigateTo('percentage-calculator')"
              >
                <div class="menu-icon">
                  <i class="fas fa-calculator"></i>
                </div>
                <h3>محاسبه درصد</h3>
                <p>محاسبه درصد بر اساس پاسخ های شما</p>
              </div>

              <div class="menu-card" onclick="navigateTo('settings')">
                <div class="menu-icon">
                  <i class="fas fa-cog"></i>
                </div>
                <h3>تنظیمات</h3>
                <p>شخصی سازی برنامه و اطلاعات سازنده</p>
              </div>
            </div>
          </div>
        </section>

        <!-- منوی کشویی تم برای موبایل -->
        <div class="mobile-theme-menu" id="mobileThemeMenu">
          <div class="theme-menu-header">
            <h3>انتخاب تم</h3>
            <button class="close-theme-menu" id="closeThemeMenu">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="mobile-theme-options">
            <button class="mobile-theme-option active" data-theme="ocean">
              <div class="theme-color ocean"></div>
              <span>اقیانوس</span>
            </button>
            <button class="mobile-theme-option" data-theme="beach">
              <div class="theme-color beach"></div>
              <span>ساحل</span>
            </button>
            <button class="mobile-theme-option" data-theme="galaxy">
              <div class="theme-color galaxy"></div>
              <span>کهکشان</span>
            </button>
            <button class="mobile-theme-option" data-theme="coal-mine">
              <div class="theme-color coal-mine"></div>
              <span>معدن زغال سنگ</span>
            </button>
          </div>
        </div>

        <!-- صفحه آزمون هوشمند (برگه‌یار) -->
        <section id="smart-exam" class="page">
          <div class="exam-container">
            <div class="exam-header">
              <h2><i class="fas fa-file-alt"></i> برگه‌یار</h2>
              <p>لطفاً کدهای تولید شده توسط هوش مصنوعی را وارد کنید</p>
            </div>

            <div class="exam-form">
              <div class="form-group">
                <label for="userAnswersCode">
                  <i class="fas fa-code"></i>
                  کد پاسخ‌های شما:
                </label>
                <textarea
                  id="userAnswersCode"
                  placeholder="کد پاسخ‌های شما را اینجا وارد کنید (مثال: 123451234512345...)"
                ></textarea>
              </div>

              <div class="form-group">
                <label for="examKeyCode">
                  <i class="fas fa-key"></i>
                  کد کلید آزمون:
                </label>
                <textarea
                  id="examKeyCode"
                  placeholder="کد کلید آزمون را اینجا وارد کنید (مثال: 123421342134213...)"
                ></textarea>
              </div>

              <div class="form-actions">
                <button
                  class="btn btn-primary ripple-effect"
                  onclick="processAIExam()"
                >
                  <i class="fas fa-cogs"></i>
                  تولید کارنامه
                </button>
                <button
                  class="btn btn-secondary ripple-effect"
                  onclick="navigateTo('main-menu')"
                >
                  <i class="fas fa-arrow-right"></i>
                  بازگشت به منو
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- صفحه آزمون دستی ( دیجیتال‌یار) -->
        <section id="manual-exam" class="page">
          <div class="exam-container">
            <div class="exam-header">
              <h2><i class="fas fa-laptop"></i> دیجیتال‌یار</h2>
              <p>لطفاً اطلاعات آزمون را به صورت دستی وارد کنید</p>
            </div>

            <div class="exam-form">
              <div class="form-group">
                <label for="manualAnswers">
                  <i class="fas fa-pen"></i>
                  پاسخ‌های شما (با کاما جدا کنید):
                </label>
                <textarea
                  id="manualAnswers"
                  placeholder="1,2,3,4,1,2,3,4,1,2,3,4,..."
                ></textarea>
              </div>

              <div class="form-group">
                <label for="manualExamKey">
                  <i class="fas fa-key"></i>
                  کلید آزمون (با کاما جدا کنید):
                </label>
                <textarea
                  id="manualExamKey"
                  placeholder="1,2,3,4,1,2,3,4,1,2,3,4,..."
                ></textarea>
              </div>

              <div class="form-group">
                <label for="examSubject">
                  <i class="fas fa-book"></i>
                  نام درس:
                </label>
                <input
                  type="text"
                  id="examSubject"
                  placeholder="نام درس را وارد کنید"
                />
              </div>

              <div class="form-actions">
                <button
                  class="btn btn-primary ripple-effect"
                  onclick="processManualExam()"
                >
                  <i class="fas fa-cogs"></i>
                  محاسبه نتایج
                </button>
                <button
                  class="btn btn-secondary ripple-effect"
                  onclick="navigateTo('main-menu')"
                >
                  <i class="fas fa-arrow-right"></i>
                  بازگشت به منو
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- صفحه محاسبه درصد -->
        <section id="percentage-calculator" class="page">
          <div class="calculator-container">
            <div class="calculator-header">
              <h2><i class="fas fa-calculator"></i> محاسبه درصد</h2>
              <p>لطفاً تعداد پاسخ‌های صحیح، غلط و نزده را وارد کنید</p>
            </div>

            <div class="calculator-form">
              <div class="calculator-inputs">
                <div class="calc-input-group">
                  <label for="correctAnswers">
                    <i class="fas fa-check-circle"></i>
                    تعداد صحیح:
                  </label>
                  <input
                    type="number"
                    id="correctAnswers"
                    min="0"
                    value="0"
                    placeholder="0"
                    onkeypress="handleCalculatorEnter(event, 'wrongAnswers')"
                    oninput="calculateTotalQuestions()"
                  />
                </div>

                <div class="calc-input-group">
                  <label for="wrongAnswers">
                    <i class="fas fa-times-circle"></i>
                    تعداد غلط:
                  </label>
                  <input
                    type="number"
                    id="wrongAnswers"
                    min="0"
                    value="0"
                    placeholder="0"
                    onkeypress="handleCalculatorEnter(event, 'emptyAnswers')"
                    oninput="calculateTotalQuestions()"
                  />
                </div>

                <div class="calc-input-group">
                  <label for="emptyAnswers">
                    <i class="fas fa-circle"></i>
                    تعداد نزده:
                  </label>
                  <input
                    type="number"
                    id="emptyAnswers"
                    min="0"
                    value="0"
                    placeholder="0"
                    onkeypress="handleCalculatorEnter(event, 'calcPercentage')"
                    oninput="calculateTotalQuestions()"
                  />
                </div>

                <div class="calc-input-group">
                  <label>
                    <i class="fas fa-list-ol"></i>
                    تعداد کل سوالات:
                  </label>
                  <div
                    class="total-questions-display"
                    id="totalQuestionsDisplay"
                  >
                    0
                  </div>
                </div>
              </div>

              <div class="calculator-result">
                <div class="result-box">
                  <h3>درصد شما:</h3>
                  <div class="percentage-value" id="percentageValue">0%</div>
                </div>
                <div class="result-box potential-result">
                  <h3>درصد بالقوه (اگر غلط نمی‌زدید):</h3>
                  <div class="percentage-value" id="potentialPercentageValue">
                    0%
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button
                  class="btn btn-primary ripple-effect"
                  id="calcPercentage"
                  onclick="calculatePercentage()"
                >
                  <i class="fas fa-calculator"></i>
                  محاسبه درصد
                </button>
                <button
                  class="btn btn-secondary ripple-effect"
                  onclick="navigateTo('main-menu')"
                >
                  <i class="fas fa-arrow-right"></i>
                  بازگشت به منو
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- لایه overlay برای منوی تم -->
        <div class="theme-menu-overlay" id="themeMenuOverlay"></div>

        <!-- صفحه تنظیمات -->
        <section id="settings" class="page">
          <div class="settings-container">
            <div class="settings-header">
              <h2><i class="fas fa-cog"></i> تنظیمات</h2>
              <p>شخصی‌سازی برنامه و اطلاعات تماس</p>
            </div>

            <div class="settings-content">
              <div class="settings-section">
                <h3><i class="fas fa-user-edit"></i> ویرایش اطلاعات کاربری</h3>
                <button
                  class="btn btn-primary ripple-effect"
                  onclick="navigateTo('user-info')"
                >
                  <i class="fas fa-edit"></i>
                  ویرایش اطلاعات
                </button>
              </div>

              <div class="settings-section">
                <h3><i class="fas fa-palette"></i> انتخاب تم</h3>
                <div class="theme-selector-large">
                  <button class="theme-btn-large active" data-theme="ocean">
                    <i class="fas fa-water"></i>
                    <span>اقیانوس</span>
                  </button>
                  <button class="theme-btn-large" data-theme="beach">
                    <i class="fas fa-umbrella-beach"></i>
                    <span>ساحل</span>
                  </button>
                  <!-- تعویض جای کهکشان و معدن زغال سنگ -->
                  <button class="theme-btn-large" data-theme="coal-mine">
                    <i class="fas fa-gem"></i>
                    <span>کهکشان</span>
                  </button>
                  <button class="theme-btn-large" data-theme="galaxy">
                    <i class="fas fa-mountain"></i>
                    <span>معدن زغال سنگ</span>
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <h3><i class="fas fa-info-circle"></i> اطلاعات سازنده</h3>
                <div class="creator-info">
                  <p>
                    <i class="fas fa-envelope"></i> پشتیبانی:
                    support.azmoonyar@gmail.com
                  </p>
                  <p><i class="fab fa-telegram"></i> تلگرام: MRtm0116</p>
                  <p class="love-message">
                    ساخته شده با عشق برای دانش‌آموزان ایران ❤️
                  </p>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                class="btn btn-secondary ripple-effect"
                onclick="navigateTo('main-menu')"
              >
                <i class="fas fa-arrow-right"></i>
                بازگشت به منو
              </button>
            </div>
          </div>
        </section>

        <!-- صفحات غیرفعال -->
        <section id="saved-exams" class="page">
          <div class="page-placeholder">
            <i class="fas fa-folder"></i>
            <h2>پوشه آزمون‌ها</h2>
            <p>این بخش به زودی فعال خواهد شد</p>
            <button
              class="btn btn-secondary ripple-effect"
              onclick="navigateTo('main-menu')"
            >
              <i class="fas fa-arrow-right"></i>
              بازگشت به منو
            </button>
          </div>
        </section>

        <section id="exam-process" class="page">
          <div class="page-placeholder">
            <i class="fas fa-chart-line"></i>
            <h2>روند آزمون</h2>
            <p>این بخش به زودی فعال خواهد شد</p>
            <button
              class="btn btn-secondary ripple-effect"
              onclick="navigateTo('main-menu')"
            >
              <i class="fas fa-arrow-right"></i>
              بازگشت به منو
            </button>
          </div>
        </section>
      </main>

      <!-- منوی موبایل -->
      <nav class="mobile-nav">
        <div class="mobile-nav-grid">
          <a
            href="javascript:void(0)"
            class="mobile-nav-item"
            onclick="navigateTo('main-menu')"
          >
            <i class="fas fa-home"></i>
            <span>منو</span>
          </a>
          <a
            href="javascript:void(0)"
            class="mobile-nav-item"
            onclick="navigateTo('percentage-calculator')"
          >
            <i class="fas fa-calculator"></i>
            <span>محاسبه</span>
          </a>
          <a
            href="javascript:void(0)"
            class="mobile-nav-item"
            onclick="navigateTo('settings')"
          >
            <i class="fas fa-cog"></i>
            <span>تنظیمات</span>
          </a>
        </div>
      </nav>

      <!-- فوتر -->
      <footer class="footer">
        <div class="footer-content">
          <p>
            ساخته شده با <i class="fas fa-heart"></i> برای دانش‌آموزان ایران |
            پشتیبانی: support.azmoonyar@gmail.com | نسخه ۴.۰.۰
          </p>
        </div>
      </footer>
    </div>

    <script>
      // ذخیره اطلاعات کاربر
      document
        .getElementById("save-btn")
        .addEventListener("click", function () {
          const name = document.getElementById("studentName").value;
          const field = document.getElementById("field").value;
          const grade = document.getElementById("grade").value;

          if (!name || !field || !grade) {
            showNotification("لطفاً تمام فیلدها را پر کنید.", "error");
            return;
          }

          // ذخیره اطلاعات در localStorage
          localStorage.setItem("studentName", name);
          localStorage.setItem("studentField", field);
          localStorage.setItem("studentGrade", grade);

          // نمایش انیمیشن موفقیت
          showCompletionAnimation();

          // به روزرسانی نام کاربر در منوی اصلی
          document.getElementById("welcome-name").textContent = name;
        });

      // تغییر در تابع navigateToBargehyar
      function navigateToBargehyar() {
        // انتقال به صفحه برگه‌یار
        window.location.href = "bargehyar.html";
      }

      // نمایش انیمیشن تکمیل ثبت نام
      function showCompletionAnimation() {
        const animation = document.getElementById("completionAnimation");
        animation.classList.add("active");

        // ایجاد کنفتی
        createConfetti();
      }

      // پنهان کردن انیمیشن تکمیل ثبت نام
      function hideCompletionAnimation() {
        const animation = document.getElementById("completionAnimation");
        animation.classList.remove("active");

        // هدایت به منوی اصلی
        setTimeout(() => {
          navigateTo("main-menu");
        }, 500);
      }

      // ایجاد کنفتی برای انیمیشن
      function createConfetti() {
        const colors = [
          "#f1c40f",
          "#e74c3c",
          "#3498db",
          "#2ecc71",
          "#9b59b6",
          "#e67e22",
        ];
        const container = document.getElementById("completionAnimation");

        // حذف کنفتی‌های قبلی
        document.querySelectorAll(".confetti").forEach((el) => el.remove());

        // ایجاد کنفتی‌های جدید
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";

          const size = Math.random() * 10 + 5;
          const color = colors[Math.floor(Math.random() * colors.length)];
          const left = Math.random() * 100;
          const delay = Math.random() * 2;
          const duration = Math.random() * 3 + 2;

          confetti.style.width = `${size}px`;
          confetti.style.height = `${size}px`;
          confetti.style.background = color;
          confetti.style.left = `${left}%`;
          confetti.style.animation = `confettiFall ${duration}s ease-in ${delay}s forwards`;

          container.appendChild(confetti);
        }
      }

      // پیمایش بین صفحات
      function navigateTo(pageId) {
        // مخفی کردن تمام صفحات
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.remove("active");
        });

        // نمایش صفحه مورد نظر
        document.getElementById(pageId).classList.add("active");

        // اسکرول به بالای صفحه
        window.scrollTo(0, 0);

        // به روزرسانی نوار پیشرفت
        updateProgressBar();

        // به روزرسانی منوی موبایل
        updateMobileNav(pageId);
      }

      // به روزرسانی منوی موبایل
      function updateMobileNav(activePage) {
        const navItems = document.querySelectorAll(".mobile-nav-item");
        navItems.forEach((item) => {
          item.classList.remove("active");
        });

        // فعال کردن آیتم مربوطه در منوی موبایل
        if (activePage === "main-menu") {
          navItems[0].classList.add("active");
        } else if (activePage === "percentage-calculator") {
          navItems[1].classList.add("active");
        } else if (activePage === "settings") {
          navItems[2].classList.add("active");
        }
      }

      // بهبود مدیریت تم‌ها برای جلوگیری از باگ
      function updateThemeStyles(theme) {
        // به روزرسانی استایل‌های خاص برای هر تم
        if (theme === "galaxy") {
          // اضافه کردن استایل‌های خاص برای تم کهکشان
          document.documentElement.style.setProperty(
            "--footer-bg",
            "rgba(12, 0, 50, 0.95)"
          );
          document.documentElement.style.setProperty(
            "--footer-text",
            "#e6e6fa"
          );
        } else if (theme === "coal-mine") {
          document.documentElement.style.setProperty(
            "--footer-bg",
            "rgba(26, 26, 29, 0.95)"
          );
          document.documentElement.style.setProperty(
            "--footer-text",
            "#edf2f4"
          );
        } else if (theme === "beach") {
          document.documentElement.style.setProperty(
            "--footer-bg",
            "rgba(255, 245, 230, 0.95)"
          );
          document.documentElement.style.setProperty(
            "--footer-text",
            "#5d4037"
          );
        } else {
          // تم پیش‌فرض (اقیانوس)
          document.documentElement.style.setProperty(
            "--footer-bg",
            "rgba(224, 247, 255, 0.95)"
          );
          document.documentElement.style.setProperty(
            "--footer-text",
            "#0a3d62"
          );
        }
      }

      // تغییر تم با به‌روزرسانی استایل‌ها
      document
        .querySelectorAll(".theme-btn, .theme-btn-large, .mobile-theme-option")
        .forEach((btn) => {
          btn.addEventListener("click", function () {
            const theme = this.getAttribute("data-theme");

            // حذف کلاس active از تمام دکمه‌ها
            document
              .querySelectorAll(
                ".theme-btn, .theme-btn-large, .mobile-theme-option"
              )
              .forEach((b) => {
                b.classList.remove("active");
              });

            // اضافه کردن کلاس active به دکمه انتخاب شده
            this.classList.add("active");

            // اعمال انیمیشن تغییر تم
            document.body.classList.add("theme-change-animation");

            // اعمال تم انتخاب شده
            document.body.setAttribute("data-theme", theme);

            // به روزرسانی استایل‌های خاص تم
            updateThemeStyles(theme);

            // ذخیره تم در localStorage
            localStorage.setItem("appTheme", theme);

            // حذف انیمیشن پس از اتمام
            setTimeout(() => {
              document.body.classList.remove("theme-change-animation");
            }, 800);

            // نمایش نوتیفیکیشن
            showNotification(`تم ${getThemeName(theme)} اعمال شد.`, "success");
          });
        });

      // بارگذاری تم ذخیره شده با به‌روزرسانی استایل‌ها
      document.addEventListener("DOMContentLoaded", function () {
        const savedTheme = localStorage.getItem("appTheme") || "ocean";
        document.body.setAttribute("data-theme", savedTheme);

        // به روزرسانی استایل‌های خاص تم
        updateThemeStyles(savedTheme);

        // به روزرسانی دکمه های تم
        document
          .querySelectorAll(
            ".theme-btn, .theme-btn-large, .mobile-theme-option"
          )
          .forEach((btn) => {
            btn.classList.remove("active");
            if (btn.getAttribute("data-theme") === savedTheme) {
              btn.classList.add("active");
            }
          });
      });

      // دریافت نام تم
      function getThemeName(theme) {
        const themes = {
          ocean: "اقیانوس",
          beach: "ساحل",
          "coal-mine": "کهکشان", // تغییر نام
          galaxy: "معدن زغال سنگ", // تغییر نام
        };
        return themes[theme] || "ناشناخته";
      }

      // محاسبه درصد با فرمول صحیح کنکوری
      function calculatePercentage() {
        const correct =
          parseInt(document.getElementById("correctAnswers").value) || 0;
        const wrong =
          parseInt(document.getElementById("wrongAnswers").value) || 0;
        const empty =
          parseInt(document.getElementById("emptyAnswers").value) || 0;
        const total =
          parseInt(document.getElementById("totalQuestions").value) || 50;

        // اعتبارسنجی
        if (correct + wrong + empty > total) {
          showNotification(
            "مجموع پاسخ‌ها نمی‌تواند بیشتر از تعداد کل سوالات باشد!",
            "error"
          );
          return;
        }

        if (total === 0) {
          document.getElementById("percentageValue").textContent = "0%";
          document.getElementById("potentialPercentageValue").textContent =
            "0%";
          return;
        }

        // محاسبه درصد اصلی با نمره منفی (فرمول کنکوری)
        const netCorrect = correct - wrong / 3; // هر 3 غلط یک صحیح کم می‌کند
        const percentage = (netCorrect / total) * 100;
        const roundedPercentage = Math.max(
          0,
          Math.min(100, percentage)
        ).toFixed(1);

        // محاسبه درصد بالقوه (بدون نمره منفی)
        const potentialPercentage = (correct / total) * 100;
        const roundedPotentialPercentage = Math.max(
          0,
          Math.min(100, potentialPercentage)
        ).toFixed(1);

        // اعمال انیمیشن به مقادیر
        animatePercentage("percentageValue", 0, roundedPercentage, 1500, "%");
        animatePercentage(
          "potentialPercentageValue",
          0,
          roundedPotentialPercentage,
          1500,
          "%"
        );

        // اعمال افکت به کارت‌های نتیجه
        const resultBoxes = document.querySelectorAll(".result-box");
        resultBoxes.forEach((box) => {
          box.classList.add("percentage-animation");
          setTimeout(() => {
            box.classList.remove("percentage-animation");
          }, 800);
        });
      }

      // انیمیشن پیشرفته برای نمایش درصد
      function animatePercentage(id, start, end, duration, suffix = "") {
        const element = document.getElementById(id);
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // استفاده از تابع easing برای انیمیشن نرم‌تر
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const currentValue = start + (end - start) * easeOutQuart;

          element.textContent = currentValue.toFixed(1) + suffix;

          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.textContent = end + suffix;

            // افزودن افکت درخشش پس از پایان انیمیشن
            element.style.animation = "glow 2s ease-in-out 3";
            setTimeout(() => {
              element.style.animation = "";
            }, 2000);
          }
        }

        requestAnimationFrame(update);
      }

      // مدیریت کلید Enter در ماشین حساب
      function handleCalculatorEnter(event, nextFieldId) {
        if (event.key === "Enter") {
          event.preventDefault();
          if (nextFieldId === "calcPercentage") {
            calculatePercentage();
          } else {
            document.getElementById(nextFieldId).focus();
          }
        }
      }

      function navigateToBargehyar() {
        const name = document.getElementById("studentName").value;
        const field = document.getElementById("field").value;
        const grade = document.getElementById("grade").value;

        if (name && field && grade) {
          localStorage.setItem("studentName", name);
          localStorage.setItem("studentField", field);
          localStorage.setItem("studentGrade", grade);

          // ذخیره تم فعال در localStorage
          const currentTheme = document.body.getAttribute("data-theme");
          localStorage.setItem("appTheme", currentTheme);

          // انتقال به صفحه برگه‌یار
          window.location.href = "bargehyar.html";
        } else {
          showNotification("لطفاً ابتدا اطلاعات خود را تکمیل کنید", "error");
          navigateTo("user-info");
        }
      }

      // شبیه‌سازی پردازش آزمون
      function processAIExam() {
        const answers = document.getElementById("userAnswersCode").value;
        const key = document.getElementById("examKeyCode").value;

        if (!answers || !key) {
          showNotification("لطفاً هر دو فیلد کد را پر کنید.", "error");
          return;
        }

        // شبیه‌سازی پردازش
        simulateProcessing(() => {
          showNotification("پردازش آزمون با موفقیت انجام شد!", "success");
        });
      }

      function processManualExam() {
        const answers = document.getElementById("manualAnswers").value;
        const key = document.getElementById("manualExamKey").value;
        const subject = document.getElementById("examSubject").value;

        if (!answers || !key || !subject) {
          showNotification("لطفاً تمام فیلدها را پر کنید.", "error");
          return;
        }

        // شبیه‌سازی پردازش
        simulateProcessing(() => {
          showNotification("پردازش آزمون دستی با موفقیت انجام شد!", "success");
        });
      }

      // شبیه‌سازی پردازش با نوار پیشرفت
      function simulateProcessing(callback) {
        const progressBar = document.getElementById("progressBar");
        let width = 0;

        const interval = setInterval(() => {
          if (width >= 100) {
            clearInterval(interval);
            if (callback) callback();
          } else {
            width += 5;
            progressBar.style.width = width + "%";
          }
        }, 50);
      }

      // نمایش نوتیفیکیشن
      function showNotification(message, type = "info") {
        // ایجاد عنصر نوتیفیکیشن
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.textContent = message;

        // استایل نوتیفیکیشن
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;

        // رنگ‌بندی بر اساس نوع
        if (type === "success") {
          notification.style.background =
            "linear-gradient(135deg, #2ecc71, #27ae60)";
        } else if (type === "error") {
          notification.style.background =
            "linear-gradient(135deg, #e74c3c, #c0392b)";
        } else {
          notification.style.background =
            "linear-gradient(135deg, #3498db, #2980b9)";
        }

        // اضافه کردن به صفحه
        document.body.appendChild(notification);

        // نمایش با انیمیشن
        setTimeout(() => {
          notification.style.opacity = "1";
        }, 10);

        // حذف پس از چند ثانیه
        setTimeout(() => {
          notification.style.opacity = "0";
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      // به روزرسانی نوار پیشرفت
      function updateProgressBar() {
        const progressBar = document.getElementById("progressBar");
        progressBar.style.width = "0%";

        setTimeout(() => {
          progressBar.style.width = "100%";
        }, 100);

        setTimeout(() => {
          progressBar.style.width = "0%";
        }, 1000);
      }

      // افکت ریپل برای دکمه‌ها
      document.querySelectorAll(".ripple-effect").forEach((button) => {
        button.addEventListener("click", function (e) {
          const x = e.clientX - e.target.getBoundingClientRect().left;
          const y = e.clientY - e.target.getBoundingClientRect().top;

          const ripples = document.createElement("span");
          ripples.style.left = x + "px";
          ripples.style.top = y + "px";
          this.appendChild(ripples);

          setTimeout(() => {
            ripples.remove();
          }, 600);
        });
      });

      // بارگذاری اطلاعات کاربر در صورت وجود
      window.addEventListener("DOMContentLoaded", function () {
        const savedName = localStorage.getItem("studentName");
        if (savedName) {
          document.getElementById("welcome-name").textContent = savedName;
          document.getElementById("studentName").value = savedName;

          // پر کردن سایر فیلدها
          document.getElementById("field").value =
            localStorage.getItem("studentField") || "";
          document.getElementById("grade").value =
            localStorage.getItem("studentGrade") || "";

          // به‌روزرسانی مراحل پیشرفت
          updateProgressSteps();
        }

        // بارگذاری تم ذخیره شده
        const savedTheme = localStorage.getItem("appTheme") || "ocean";
        document.body.setAttribute("data-theme", savedTheme);

        // فعال کردن دکمه تم ذخیره شده
        document
          .querySelectorAll(`.theme-btn[data-theme="${savedTheme}"]`)
          .forEach((btn) => {
            btn.classList.add("active");
          });
        document
          .querySelectorAll(`.theme-btn-large[data-theme="${savedTheme}"]`)
          .forEach((btn) => {
            btn.classList.add("active");
          });

        // به روزرسانی نوار پیشرفت
        updateProgressBar();

        // به روزرسانی منوی موبایل
        updateMobileNav("main-menu");

        // ایجاد المان‌های بصری جدید
        createVisualElements();
      });

      // ایجاد المان‌های بصری جدید
      function createVisualElements() {
        const backgroundEffects = document.querySelector(".background-effects");

        // ایجاد حباب‌های اضافی
        for (let i = 0; i < 5; i++) {
          const bubble = document.createElement("div");
          bubble.className = "bubble-small";

          // موقعیت‌های تصادفی
          const size = Math.random() * 30 + 10;
          const top = Math.random() * 100;
          const left = Math.random() * 100;
          const duration = Math.random() * 10 + 10;
          const delay = Math.random() * 5;

          bubble.style.width = `${size}px`;
          bubble.style.height = `${size}px`;
          bubble.style.top = `${top}%`;
          bubble.style.left = `${left}%`;
          bubble.style.animationDuration = `${duration}s`;
          bubble.style.animationDelay = `${delay}s`;

          backgroundEffects.appendChild(bubble);
        }

        // ایجاد ذرات شناور اضافی
        for (let i = 0; i < 3; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";

          // موقعیت‌های تصادفی
          const size = Math.random() * 8 + 5;
          const top = Math.random() * 100;
          const left = Math.random() * 100;
          const duration = Math.random() * 15 + 15;
          const delay = Math.random() * 10;

          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.top = `${top}%`;
          particle.style.left = `${left}%`;
          particle.style.animationDuration = `${duration}s`;
          particle.style.animationDelay = `${delay}s`;

          backgroundEffects.appendChild(particle);
        }
      }

      // به‌روزرسانی مراحل پیشرفت
      function updateProgressSteps() {
        const name = document.getElementById("studentName").value;
        const field = document.getElementById("field").value;
        const grade = document.getElementById("grade").value;

        // حذف وضعیت تکمیل از تمام مراحل
        document.querySelectorAll(".step").forEach((step) => {
          step.classList.remove("completed");
        });

        // پر کردن مجدد وضعیت مراحل
        if (name) {
          document.getElementById("step-name").classList.add("completed");
          document.getElementById("progressFill").style.width = "25%";
        }

        if (field) {
          document.getElementById("step-field").classList.add("completed");
          document.getElementById("progressFill").style.width = "50%";
        }

        if (grade) {
          document.getElementById("step-grade").classList.add("completed");
          document.getElementById("progressFill").style.width = "75%";
        }

        if (name && field && grade) {
          document.getElementById("step-complete").classList.add("completed");
          document.getElementById("progressFill").style.width = "100%";
        }
      }

      // تغییر تابع navigateToBargehyar
      function navigateToBargehyar() {
        const name = document.getElementById("studentName").value;
        const field = document.getElementById("field").value;
        const grade = document.getElementById("grade").value;

        if (name && field && grade) {
          localStorage.setItem("studentName", name);
          localStorage.setItem("studentField", field);
          localStorage.setItem("studentGrade", grade);

          // انتقال به صفحه برگه‌یار
          window.location.href = "bargehyar.html";
        } else {
          showNotification("لطفاً ابتدا اطلاعات خود را تکمیل کنید", "error");
          navigateTo("user-info");
        }
      }

      // به روزرسانی بخش بارگذاری تم
      document.addEventListener("DOMContentLoaded", function () {
        // بارگذاری تم ذخیره شده
        const savedTheme = localStorage.getItem("appTheme") || "ocean";
        document.body.setAttribute("data-theme", savedTheme);

        // به روزرسانی دکمه های تم
        document
          .querySelectorAll(".theme-btn, .theme-btn-large")
          .forEach((btn) => {
            btn.classList.remove("active");
            if (btn.getAttribute("data-theme") === savedTheme) {
              btn.classList.add("active");
            }
          });
      });

      // به‌روزرسانی مراحل پیشرفت هنگام تغییر مقادیر
      document
        .getElementById("studentName")
        .addEventListener("input", updateProgressSteps);
      document
        .getElementById("field")
        .addEventListener("change", updateProgressSteps);
      document
        .getElementById("grade")
        .addEventListener("change", updateProgressSteps);

      // محاسبه خودکار تعداد کل سوالات
      function calculateTotalQuestions() {
        const correct =
          parseInt(document.getElementById("correctAnswers").value) || 0;
        const wrong =
          parseInt(document.getElementById("wrongAnswers").value) || 0;
        const empty =
          parseInt(document.getElementById("emptyAnswers").value) || 0;

        const total = correct + wrong + empty;
        document.getElementById("totalQuestionsDisplay").textContent = total;
      }

      // تابع جدید برای محاسبه درصدها با فرمول صحیح
      function calcPercentages(correct, wrong, total) {
        // درصــد واقعی (با نمره منفی)
        const realPercent = ((correct - wrong / 3) / total) * 100;

        // درصد بالقوه (اگه غلط ها رو سفید میزدی)
        const potentialPercent = (correct / total) * 100;

        // برای گرد کردن به دو رقم اعشار:
        return {
          realPercent: Math.max(0, realPercent).toFixed(2),
          potentialPercent: Math.max(0, potentialPercent).toFixed(2),
        };
      }

      // محاسبه درصد با فرمول صحیح کنکوری
      function calculatePercentage() {
        const correct =
          parseInt(document.getElementById("correctAnswers").value) || 0;
        const wrong =
          parseInt(document.getElementById("wrongAnswers").value) || 0;
        const empty =
          parseInt(document.getElementById("emptyAnswers").value) || 0;
        const total = correct + wrong + empty;

        // اعتبارسنجی
        if (total === 0) {
          showNotification("لطفاً حداقل یک سوال را پاسخ داده باشید!", "error");
          return;
        }

        // استفاده از تابع جدید برای محاسبه درصدها
        const percentages = calcPercentages(correct, wrong, total);

        // اعمال انیمیشن به مقادیر
        animatePercentage(
          "percentageValue",
          0,
          percentages.realPercent,
          1500,
          "%"
        );
        animatePercentage(
          "potentialPercentageValue",
          0,
          percentages.potentialPercent,
          1500,
          "%"
        );

        // اعمال افکت به کارت‌های نتیجه
        const resultBoxes = document.querySelectorAll(".result-box");
        resultBoxes.forEach((box) => {
          box.classList.add("percentage-animation");
          setTimeout(() => {
            box.classList.remove("percentage-animation");
          }, 800);
        });
      }

      // انیمیشن پیشرفته برای نمایش درصد
      function animatePercentage(id, start, end, duration, suffix = "") {
        const element = document.getElementById(id);
        const startTime = performance.now();

        // تبدیل مقادیر به عدد
        const startValue = parseFloat(start);
        const endValue = parseFloat(end);

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // استفاده از تابع easing برای انیمیشن نرم‌تر
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const currentValue =
            startValue + (endValue - startValue) * easeOutQuart;

          element.textContent = currentValue.toFixed(2) + suffix;

          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.textContent = endValue.toFixed(2) + suffix;

            // افزودن افکت درخشش پس از پایان انیمیشن
            element.style.animation = "glow 2s ease-in-out 3";
            setTimeout(() => {
              element.style.animation = "";
            }, 2000);
          }
        }

        requestAnimationFrame(update);
      }

      // باز کردن منوی کشویی تم
      document
        .getElementById("mobileThemeToggle")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("mobileThemeMenu").classList.add("active");
          document.getElementById("themeMenuOverlay").classList.add("active");
          document.body.style.overflow = "hidden";
        });

      // بستن منوی کشویی تم
      document
        .getElementById("closeThemeMenu")
        .addEventListener("click", function () {
          closeThemeMenu();
        });

      // بستن منوی کشویی با کلیک روی overlay
      document
        .getElementById("themeMenuOverlay")
        .addEventListener("click", function () {
          closeThemeMenu();
        });

      // بستن منوی کشویی با کلید ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeThemeMenu();
        }
      });

      // تابع برای بستن منوی تم
      function closeThemeMenu() {
        document.getElementById("mobileThemeMenu").classList.remove("active");
        document.getElementById("themeMenuOverlay").classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // تغییر تم از طریق منوی کشویی
      document.querySelectorAll(".mobile-theme-option").forEach((option) => {
        option.addEventListener("click", function () {
          const theme = this.getAttribute("data-theme");

          // حذف کلاس active از تمام گزینه‌ها
          document.querySelectorAll(".mobile-theme-option").forEach((opt) => {
            opt.classList.remove("active");
          });

          // اضافه کردن کلاس active به گزینه انتخاب شده
          this.classList.add("active");

          // اعمال تم انتخاب شده
          document.body.setAttribute("data-theme", theme);

          // ذخیره تم در localStorage
          localStorage.setItem("appTheme", theme);

          // به روزرسانی دکمه‌های تم در هدر
          document
            .querySelectorAll(".theme-btn, .theme-btn-large")
            .forEach((btn) => {
              btn.classList.remove("active");
              if (btn.getAttribute("data-theme") === theme) {
                btn.classList.add("active");
              }
            });

          // نمایش نوتیفیکیشن
          showNotification(`تم ${getThemeName(theme)} اعمال شد.`, "success");

          // بستن منوی کشویی پس از انتخاب
          setTimeout(closeThemeMenu, 500);
        });
      });

      // جلوگیری از اسکرول صفحه وقتی منوی تم باز است
      document.getElementById("mobileThemeMenu").addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      // مدیریت منوی تم در موبایل
      document
        .getElementById("mobileThemeToggle")
        .addEventListener("click", function () {
          document.getElementById("themeSelector").classList.toggle("active");
        });

      // باز کردن منوی کشویی تم
      document
        .getElementById("mobileThemeToggle")
        .addEventListener("click", function (e) {
          if (window.innerWidth <= 768) {
            e.preventDefault();
            document.getElementById("mobileThemeMenu").classList.add("active");
            document.getElementById("themeMenuOverlay").classList.add("active");
            document.body.style.overflow = "hidden";
          }
        });

      // بستن منوی کشویی تم
      document
        .getElementById("closeThemeMenu")
        .addEventListener("click", function () {
          document.getElementById("mobileThemeMenu").classList.remove("active");
          document
            .getElementById("themeMenuOverlay")
            .classList.remove("active");
          document.body.style.overflow = "auto";
        });

      // بستن منوی کشویی با کلیک روی overlay
      document
        .getElementById("themeMenuOverlay")
        .addEventListener("click", function () {
          document.getElementById("mobileThemeMenu").classList.remove("active");
          this.classList.remove("active");
          document.body.style.overflow = "auto";
        });

      // تغییر تم از طریق منوی کشویی
      document.querySelectorAll(".mobile-theme-option").forEach((option) => {
        option.addEventListener("click", function () {
          const theme = this.getAttribute("data-theme");

          // حذف کلاس active از تمام گزینه‌ها
          document.querySelectorAll(".mobile-theme-option").forEach((opt) => {
            opt.classList.remove("active");
          });

          // اضافه کردن کلاس active به گزینه انتخاب شده
          this.classList.add("active");

          // اعمال تم انتخاب شده
          document.body.setAttribute("data-theme", theme);

          // ذخیره تم در localStorage
          localStorage.setItem("appTheme", theme);

          // به روزرسانی دکمه‌های تم در هدر
          document
            .querySelectorAll(".theme-btn, .theme-btn-large")
            .forEach((btn) => {
              btn.classList.remove("active");
              if (btn.getAttribute("data-theme") === theme) {
                btn.classList.add("active");
              }
            });

          // نمایش نوتیفیکیشن
          showNotification(`تم ${getThemeName(theme)} اعمال شد.`, "success");

          // بستن منوی کشویی پس از انتخاب
          setTimeout(() => {
            document
              .getElementById("mobileThemeMenu")
              .classList.remove("active");
            document
              .getElementById("themeMenuOverlay")
              .classList.remove("active");
            document.body.style.overflow = "auto";
          }, 500);
        });
      });

      // بستن منوی تم وقتی در حالت دسکتاپ هستیم و صفحه resize می‌شود
      window.addEventListener("resize", function () {
        if (window.innerWidth > 768) {
          document.getElementById("themeSelector").classList.remove("active");
        }
      });

      // جلوگیری از اسکرول صفحه وقتی منوی تم باز است
      document.getElementById("mobileThemeMenu").addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      // خالی کردن فیلدهای ماشین حساب
      document.getElementById("correctAnswers").value = "";
      document.getElementById("wrongAnswers").value = "";
      document.getElementById("emptyAnswers").value = "";
      document.getElementById("totalQuestionsDisplay").textContent = "0";
      document.getElementById("percentageValue").textContent = "0%";
      document.getElementById("potentialPercentageValue").textContent = "0%";
    </script>
  </body>
</html>
